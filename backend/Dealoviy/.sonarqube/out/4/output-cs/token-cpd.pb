Ì
WD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
{ 
builder 
. 
Services 
.		 	
AddApplication			 
(		 
)		 
.

 	
AddInfrastructure

	 
(

 
builder

 "
.

" #
Configuration

# 0
)

0 1
. 	
	AddWebApi	 
( 
) 
; 
} 
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
{ 
app 
. 
UseExceptionHandler 
( 
$str $
)$ %
;% &
app 
. 
Map 
( 
$str 
, 
( 
HttpContext "
context# *
)* +
=>, .
{ 
	Exception 
? 
	exception 
= 
context &
.& '
Features' /
./ 0
Get0 3
<3 4$
IExceptionHandlerFeature4 L
>L M
(M N
)N O
?O P
.P Q
ErrorQ V
;V W
return 
Results 
. 
Problem 
( 
)  
;  !
} 
) 
; 
app 
. 
UseHttpsRedirection 
( 
) 
; 
app 
. 
UseCors 
( 
opt 
=> 
opt 
. 	
AllowAnyHeader	 
( 
) 
. 	
AllowAnyMethod	 
( 
) 
. 	
AllowCredentials	 
( 
) 
. 	
WithOrigins	 
( 
builder 
. 
Configuration *
.* +

GetSection+ 5
(5 6
$str6 >
)> ?
.? @
Get@ C
<C D
stringD J
>J K
(K L
)L M
!M N
)N O
)O P
;P Q
app   
.   
UseAuthentication   
(   
)   
;   
app!! 
.!! 
UseAuthorization!! 
(!! 
)!! 
;!! 
app"" 
."" 
MapControllers"" 
("" 
)"" 
;"" 
app## 
.## 
Run## 
(## 
)## 
;## 
}$$ «
cD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\DependencyInjection.cs
	namespace 	
Dealoviy
 
. 
WebApi 
; 
public 
static 
class 
DependencyInjection '
{ 
public 

static 
IServiceCollection $
	AddWebApi% .
(. /
this/ 3
IServiceCollection4 F
servicesG O
)O P
{ 
services		 
.		 
AddControllers		 
(		  
)		  !
;		! "
services

 
.

 
AddMappings

 
(

 
)

 
;

 
return 
services 
; 
} 
} å*
kD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Controllers\UsersController.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Controllers %
;% &
[ 
Route 
( 
$str 
) 
] 
public 
class 
UsersController 
: 
ApiController ,
{ 
private 
readonly 
ISender 
	_mediator &
;& '
private 
readonly 
IMapper 
_mapper $
;$ %
public 

UsersController 
( 
ISender "
mediator# +
,+ ,
IMapper- 4
mapper5 ;
); <
{ 
	_mediator 
= 
mediator 
; 
_mapper 
= 
mapper 
; 
} 
[ 
	HttpPatch 
] 
public 

async 
Task 
< 
IActionResult #
># $

UpdateUser% /
(/ 0
[0 1
FromBody1 9
]9 :
UpdateUserRequest; L
requestM T
)T U
{ 
await 
Task 
. 
CompletedTask  
;  !
return 
Ok 
( 
$str -
)- .
;. /
}   
["" 
HttpGet"" 
("" 
$str"" 
)"" 
]"" 
public## 

async## 
Task## 
<## 
IActionResult## #
>### $
GetOwnServices##% 3
(##3 4
)##4 5
{$$ 
var%% 
userId%% 
=%% 
	GetUserId%% 
(%% 
)%%  
;%%  !
var&& 
query&& 
=&& 
new&& 
GetOwnServicesQuery&& +
(&&+ ,
userId&&, 2
)&&2 3
;&&3 4
var'' 
result'' 
='' 
await'' 
	_mediator'' $
.''$ %
Send''% )
('') *
query''* /
)''/ 0
;''0 1
return)) 
result)) 
.)) 
Match)) 
<)) 
IActionResult)) )
>))) *
())* +
success** 
=>** 
Ok** 
(** 
success** !
)**! "
,**" #
error++ 
=>++ 
Problem++ 
(++ 
error++ "
)++" #
),, 	
;,,	 

}-- 
[// 
HttpGet// 
(// 
$str// 
)// 
]// 
public00 

async00 
Task00 
<00 
IActionResult00 #
>00# $
GetServiceStats00% 4
(004 5
)005 6
{11 
var22 
userId22 
=22 
	GetUserId22 
(22 
)22  
;22  !
var33 
query33 
=33 
new33 %
GetServicesWithStatsQuery33 1
(331 2
userId332 8
)338 9
;339 :
var44 
result44 
=44 
await44 
	_mediator44 $
.44$ %
Send44% )
(44) *
query44* /
)44/ 0
;440 1
return66 
result66 
.66 
Match66 
<66 
IActionResult66 )
>66) *
(66* +
success77 
=>77 
Ok77 
(77 
_mapper77 !
.77! "
Map77" %
<77% &
IEnumerable77& 1
<771 2#
ServiceTaskStatResponse772 I
>77I J
>77J K
(77K L
success77L S
)77S T
)77T U
,77U V
error88 
=>88 
Problem88 
(88 
error88 "
)88" #
)99 	
;99	 

}:: 
[<< 
HttpGet<< 
]<< 
public== 

async== 
Task== 
<== 
IActionResult== #
>==# $
GetUser==% ,
(==, -
)==- .
{>> 
await?? 
Task?? 
.?? 
CompletedTask??  
;??  !
var@@ 
userId@@ 
=@@ 
	GetUserId@@ 
(@@ 
)@@  
;@@  !
varBB 
queryBB 
=BB 
newBB 
GetUserByIdQueryBB (
(BB( )
userIdBB) /
)BB/ 0
;BB0 1
varCC 
resultCC 
=CC 
awaitCC 
	_mediatorCC $
.CC$ %
SendCC% )
(CC) *
queryCC* /
)CC/ 0
;CC0 1
returnEE 
resultEE 
.EE 
MatchEE 
<EE 
IActionResultEE )
>EE) *
(EE* +
successFF 
=>FF 
OkFF 
(FF 
successFF !
.FF! "
AdaptFF" '
<FF' (
UserResponseFF( 4
>FF4 5
(FF5 6
)FF6 7
)FF7 8
,FF8 9
errorGG 
=>GG 
ProblemGG 
(GG 
errorGG "
)GG" #
)HH 	
;HH	 

}II 
}JJ ÚM
nD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Controllers\ServicesController.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Controllers %
;% &
[ 
Route 
( 
$str 
) 
] 
public 
class 
ServicesController 
:  !
ApiController" /
{ 
private 
readonly 
ISender 
	_mediator &
;& '
private 
readonly 
IMapper 
_mapper $
;$ %
public 

ServicesController 
( 
ISender %
mediator& .
,. /
IMapper0 7
mapper8 >
)> ?
{ 
	_mediator 
= 
mediator 
; 
_mapper 
= 
mapper 
; 
} 
[ 
HttpPost 
] 
public 

async 
Task 
< 
IActionResult #
># $
CreateService% 2
(2 3 
CreateServiceRequest3 G
requestH O
)O P
{ 
var 
userId 
= 
	GetUserId 
( 
)  
;  !
var!! 
command!! 
=!! 
new!!  
CreateServiceCommand!! .
(!!. /
userId"" 
,"" 
request## 
.## 
CityId## 
,## 
request$$ 
.$$ 
Name$$ 
,$$ 
request%% 
.%% 
Description%% 
,%%  
request&& 
.&& 
LowerPriceBound&& #
,&&# $
request'' 
.'' 
UpperPriceBound'' #
)(( 	
;((	 

var** 
result** 
=** 
await** 
	_mediator** $
.**$ %
Send**% )
(**) *
command*** 1
)**1 2
;**2 3
return,, 
result,, 
.,, 
Match,, 
<,, 
IActionResult,, )
>,,) *
(,,* +
success-- 
=>-- 
Ok-- 
(-- 
$str-- 8
)--8 9
,--9 :
error.. 
=>.. 
Problem.. 
(.. 
error.. "
).." #
)// 	
;//	 

}00 
[22 
HttpPut22 
(22 
$str22 
)22  
]22  !
public33 

async33 
Task33 
<33 
IActionResult33 #
>33# $
UpdateService33% 2
(332 3
Guid333 7
	serviceId338 A
,33A B 
UpdateServiceRequest33C W
request33X _
)33_ `
{44 
var55 
userId55 
=55 
	GetUserId55 
(55 
)55  
;55  !
var77 
command77 
=77 
new77  
UpdateServiceCommand77 .
(77. /
	serviceId88 
,88 
request99 
.99 
CityId99 
,99 
request:: 
.:: 
Name:: 
,:: 
request;; 
.;; 
Description;; 
,;;  
request<< 
.<< 
LowerPriceBound<< #
,<<# $
request== 
.== 
UpperPriceBound== #
)>> 	
;>>	 

var@@ 
result@@ 
=@@ 
await@@ 
	_mediator@@ $
.@@$ %
Send@@% )
(@@) *
command@@* 1
)@@1 2
;@@2 3
returnBB 
resultBB 
.BB 
MatchBB 
<BB 
IActionResultBB )
>BB) *
(BB* +
successCC 
=>CC 
OkCC 
(CC 
$strCC 8
)CC8 9
,CC9 :
errorDD 
=>DD 
ProblemDD 
(DD 
errorDD "
)DD" #
)EE 	
;EE	 

}FF 
[HH 
HttpGetHH 
(HH 
$strHH 
)HH 
]HH 
publicII 

asyncII 
TaskII 
<II 
IActionResultII #
>II# $'
GetServicesByKeywordAndCityII% @
(II@ A
[JJ 	
	FromQueryJJ	 
]JJ 
stringJJ 
keywordJJ "
,JJ" #
[KK 	
	FromQueryKK	 
]KK 
GuidKK 
cityIdKK 
)KK  
{LL 
varMM 
queryMM 
=MM 
newMM $
GetByKeywordAndCityQueryMM 0
(MM0 1
keywordMM1 8
,MM8 9
cityIdMM: @
)MM@ A
;MMA B
varOO 
resultOO 
=OO 
awaitOO 
	_mediatorOO $
.OO$ %
SendOO% )
(OO) *
queryOO* /
)OO/ 0
;OO0 1
returnQQ 
resultQQ 
.QQ 
MatchQQ 
<QQ 
IActionResultQQ )
>QQ) *
(QQ* +
successRR 
=>RR 
OkRR 
(RR 
_mapperRR !
.RR! "
MapRR" %
<RR% &!
ServiceSearchResponseRR& ;
>RR; <
(RR< =
successRR= D
)RRD E
)RRE F
,RRF G
errorSS 
=>SS 
ProblemSS 
(SS 
errorSS "
)SS" #
)TT 	
;TT	 

}UU 
[WW 
HttpGetWW 
(WW 
$strWW 
)WW  
]WW  !
publicXX 

asyncXX 
TaskXX 
<XX 
IActionResultXX #
>XX# $

GetServiceXX% /
(XX/ 0
GuidXX0 4
	serviceIdXX5 >
)XX> ?
{YY 
varZZ 
queryZZ 
=ZZ 
newZZ 
GetServiceByIdQueryZZ +
(ZZ+ ,
	serviceIdZZ, 5
)ZZ5 6
;ZZ6 7
var\\ 
result\\ 
=\\ 
await\\ 
	_mediator\\ $
.\\$ %
Send\\% )
(\\) *
query\\* /
)\\/ 0
;\\0 1
return^^ 
result^^ 
.^^ 
Match^^ 
<^^ 
IActionResult^^ )
>^^) *
(^^* +
success__ 
=>__ 
Ok__ 
(__ 
success__ !
.__! "
Adapt__" '
<__' (
ServiceResponse__( 7
>__7 8
(__8 9
)__9 :
)__: ;
,__; <
error`` 
=>`` 
Problem`` 
(`` 
error`` "
)``" #
)aa 	
;aa	 

}bb 
[dd 
HttpPostdd 
(dd 
$strdd (
)dd( )
]dd) *
publicee 

asyncee 
Taskee 
<ee 
IActionResultee #
>ee# $
CreateReviewee% 1
(ee1 2
[ff 	
	FromRouteff	 
]ff 
Guidff 
	serviceIdff "
,ff" #
[gg 	
FromBodygg	 
]gg 
CreateReviewRequestgg &
requestgg' .
)gg. /
{hh 
varii 
userIdii 
=ii 
	GetUserIdii 
(ii 
)ii  
;ii  !
varkk 
commandkk 
=kk 
newkk %
AddReviewOnServiceCommandkk 3
(kk3 4
	serviceIdll 
,ll 
userIdmm 
,mm 
requestnn 
.nn 
Ratingnn 
,nn 
requestoo 
.oo 

ReviewTextoo 
)pp 	
;pp	 

varrr 
resultrr 
=rr 
awaitrr 
	_mediatorrr $
.rr$ %
Sendrr% )
(rr) *
commandrr* 1
)rr1 2
;rr2 3
returntt 
resulttt 
.tt 
Matchtt 
<tt 
IActionResulttt )
>tt) *
(tt* +
successuu 
=>uu 
Okuu 
(uu 
$struu 7
)uu7 8
,uu8 9
errorvv 
=>vv 
Problemvv 
(vv 
errorvv "
)vv" #
)ww 	
;ww	 

}xx 
[zz 
HttpGetzz 
(zz 
$strzz '
)zz' (
]zz( )
public{{ 

async{{ 
Task{{ 
<{{ 
IActionResult{{ #
>{{# $ 
GetReviewsForService{{% 9
({{9 :
[{{: ;
	FromRoute{{; D
]{{D E
Guid{{F J
	serviceId{{K T
){{T U
{|| 
var}} 
query}} 
=}} 
new}} %
GetReviewsForServiceQuery}} 1
(}}1 2
	serviceId}}2 ;
)}}; <
;}}< =
var 
result 
= 
await 
	_mediator $
.$ %
Send% )
() *
query* /
)/ 0
;0 1
return
 
result
 
.
 
Match
 
<
 
IActionResult
 )
>
) *
(
* +
success
‚‚ 
=>
‚‚ 
Ok
‚‚ 
(
‚‚ 
success
‚‚ !
.
‚‚! "
Adapt
‚‚" '
<
‚‚' (
IEnumerable
‚‚( 3
<
‚‚3 4
ReviewResponse
‚‚4 B
>
‚‚B C
>
‚‚C D
(
‚‚D E
)
‚‚E F
)
‚‚F G
,
‚‚G H
error
ƒƒ 
=>
ƒƒ 
Problem
ƒƒ 
(
ƒƒ 
error
ƒƒ "
)
ƒƒ" #
)
„„ 	
;
„„	 

}
…… 
}†† úF
nD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Controllers\RequestsController.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Controllers %
;% &
[ 
Route 
( 
$str 
) 
] 
public 
class 
RequestsController 
:  !
ApiController" /
{ 
private 
readonly 
ISender 
	_mediator &
;& '
private 
readonly 
IMapper 
_mapper $
;$ %
public 

RequestsController 
( 
ISender %
mediator& .
,. /
IMapper0 7
mapper8 >
)> ?
{ 
	_mediator 
= 
mediator 
; 
_mapper 
= 
mapper 
; 
} 
[ 
HttpGet 
( 
$str 1
)1 2
]2 3
public 

async 
Task 
< 
IActionResult #
># $!
GetRequestsForService% :
(: ;
[ 	
	FromRoute	 
] 
Guid 
	serviceId "
)" #
{ 
var 
query 
= 
new &
GetRequestsForServiceQuery 2
(2 3
	serviceId3 <
)< =
;= >
var   
result   
=   
await   
	_mediator   $
.  $ %
Send  % )
(  ) *
query  * /
)  / 0
;  0 1
return!! 
result!! 
.!! 
Match!! 
<!! 
IActionResult!! )
>!!) *
(!!* +
success"" 
=>"" 
Ok"" 
("" 
success"" !
)""! "
,""" #
error## 
=>## 
Problem## 
(## 
error## "
)##" #
)$$ 	
;$$	 

}%% 
['' 
HttpPost'' 
('' 
$str'' 0
)''0 1
]''1 2
public(( 

async(( 
Task(( 
<(( 
IActionResult(( #
>((# $
AcceptRequest((% 2
(((2 3
[)) 	
	FromRoute))	 
])) 
Guid)) 
	requestId)) "
)))" #
{** 
var++ 
userId++ 
=++ 
	GetUserId++ 
(++ 
)++  
;++  !
var,, 
command,, 
=,, 
new,,  
AcceptRequestCommand,, .
(,,. /
	requestId,,/ 8
,,,8 9
userId,,: @
),,@ A
;,,A B
var-- 
result-- 
=-- 
await-- 
	_mediator-- $
.--$ %
Send--% )
(--) *
command--* 1
)--1 2
;--2 3
return.. 
result.. 
... 
Match.. 
<.. 
IActionResult.. )
>..) *
(..* +
success// 
=>// 
Ok// 
(// 
)// 
,// 
error00 
=>00 
Problem00 
(00 
error00 "
)00" #
)11 	
;11	 

}22 
[44 
HttpPost44 
(44 
$str44 1
)441 2
]442 3
public55 

async55 
Task55 
<55 
IActionResult55 #
>55# $
DeclineRequest55% 3
(553 4
[66 	
	FromRoute66	 
]66 
Guid66 
	requestId66 "
)66" #
{77 
var88 
userId88 
=88 
	GetUserId88 
(88 
)88  
;88  !
var99 
command99 
=99 
new99 !
DeclineRequestCommand99 /
(99/ 0
	requestId990 9
,999 :
userId99; A
)99A B
;99B C
var:: 
result:: 
=:: 
await:: 
	_mediator:: $
.::$ %
Send::% )
(::) *
command::* 1
)::1 2
;::2 3
return;; 
result;; 
.;; 
Match;; 
<;; 
IActionResult;; )
>;;) *
(;;* +
success<< 
=><< 
Ok<< 
(<< 
)<< 
,<< 
error== 
=>== 
Problem== 
(== 
error== "
)==" #
)>> 	
;>>	 

}?? 
[AA 

HttpDeleteAA 
(AA 
$strAA +
)AA+ ,
]AA, -
publicBB 

asyncBB 
TaskBB 
<BB 
IActionResultBB #
>BB# $
DeleteRequestBB% 2
(BB2 3
[CC 	
	FromRouteCC	 
]CC 
GuidCC 
	requestIdCC "
)CC" #
{DD 
varEE 
userIdEE 
=EE 
	GetUserIdEE 
(EE 
)EE  
;EE  !
varFF 
commandFF 
=FF 
newFF *
DeleteRequestIfDeclinedCommandFF 8
(FF8 9
	requestIdFF9 B
,FFB C
userIdFFD J
)FFJ K
;FFK L
varGG 
resultGG 
=GG 
awaitGG 
	_mediatorGG $
.GG$ %
SendGG% )
(GG) *
commandGG* 1
)GG1 2
;GG2 3
returnHH 
resultHH 
.HH 
MatchHH 
<HH 
IActionResultHH )
>HH) *
(HH* +
successII 
=>II 
OkII 
(II 
)II 
,II 
errorJJ 
=>JJ 
ProblemJJ 
(JJ 
errorJJ "
)JJ" #
)KK 	
;KK	 

}LL 
[NN 
HttpGetNN 
(NN 
$strNN 
)NN 
]NN 
publicOO 

asyncOO 
TaskOO 
<OO 
IActionResultOO #
>OO# $
GetUsersRequestsOO% 5
(OO5 6
)OO6 7
{PP 
varQQ 
userIdQQ 
=QQ 
	GetUserIdQQ 
(QQ 
)QQ  
;QQ  !
varRR 
queryRR 
=RR 
newRR #
GetRequestsForUserQueryRR /
(RR/ 0
userIdRR0 6
)RR6 7
;RR7 8
varSS 
resultSS 
=SS 
awaitSS 
	_mediatorSS $
.SS$ %
SendSS% )
(SS) *
querySS* /
)SS/ 0
;SS0 1
returnTT 
resultTT 
.TT 
MatchTT 
<TT 
IActionResultTT )
>TT) *
(TT* +
successUU 
=>UU 
OkUU 
(UU 
successUU !
)UU! "
,UU" #
errorVV 
=>VV 
ProblemVV 
(VV 
errorVV "
)VV" #
)WW 	
;WW	 

}XX 
[ZZ 
HttpPostZZ 
(ZZ 
$strZZ 2
)ZZ2 3
]ZZ3 4
public[[ 

async[[ 
Task[[ 
<[[ 
IActionResult[[ #
>[[# $
CreateRequest[[% 2
([[2 3
[\\ 	
	FromRoute\\	 
]\\ 
Guid\\ 
	serviceId\\ "
,\\" #
[]] 	
FromBody]]	 
]]]  
CreateRequestRequest]] '
request]]( /
)]]/ 0
{^^ 
var__ 
userId__ 
=__ 
	GetUserId__ 
(__ 
)__  
;__  !
var`` 
command`` 
=`` 
new``  
CreateRequestCommand`` .
(``. /
	serviceIdaa 
,aa 
userIdbb 
,bb 
requestcc 
.cc 
Descriptioncc 
,cc  
_mapperdd 
.dd 
Mapdd 
<dd 
ContactInfoModeldd (
>dd( )
(dd) *
requestdd* 1
.dd1 2
CustomerContactInfodd2 E
)ddE F
,ddF G
requestee 
.ee 
PaymentAmountee !
)ee! "
;ee" #
vargg 
resultgg 
=gg 
awaitgg 
	_mediatorgg $
.gg$ %
Sendgg% )
(gg) *
commandgg* 1
)gg1 2
;gg2 3
returnhh 
resulthh 
.hh 
Matchhh 
<hh 
IActionResulthh )
>hh) *
(hh* +
successii 
=>ii 
Okii 
(ii 
)ii 
,ii 
errorjj 
=>jj 
Problemjj 
(jj 
errorjj "
)jj" #
)kk 	
;kk	 

}ll 
}mm ²
mD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Controllers\RegionsController.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Controllers %
;% &
[		 
AllowAnonymous		 
]		 
[

 
Route

 
(

 
$str

 
)

 
]

 
public 
class 
RegionsController 
:  
ApiController! .
{ 
private 
readonly 
ISender 
	_mediator &
;& '
private 
readonly 
IMapper 
_mapper $
;$ %
public 

RegionsController 
( 
ISender $
mediator% -
,- .
IMapper/ 6
mapper7 =
)= >
{ 
	_mediator 
= 
mediator 
; 
_mapper 
= 
mapper 
; 
} 
[ 
HttpGet 
] 
public 

async 
Task 
< 
IActionResult #
># $

GetRegions% /
(/ 0
)0 1
{ 
var 
query 
= 
new 
GetRegionsQuery '
(' (
)( )
;) *
var 
regions 
= 
await 
	_mediator %
.% &
Send& *
(* +
query+ 0
)0 1
;1 2
return 
Ok 
( 
_mapper 
. 
Map 
< 
IEnumerable )
<) *
RegionResponse* 8
>8 9
>9 :
(: ;
regions; B
)B C
)C D
;D E
} 
} ¥.
lD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Controllers\OrdersController.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Controllers %
;% &
[

 
Route

 
(

 
$str

 
)

 
]

 
public 
class 
OrdersController 
: 
ApiController  -
{ 
private 
readonly 
ISender 
	_mediator &
;& '
public 

OrdersController 
( 
ISender #
mediator$ ,
), -
{ 
	_mediator 
= 
mediator 
; 
} 
[ 
HttpGet 
( 
$str /
)/ 0
]0 1
public 

async 
Task 
< 
IActionResult #
># $
GetOrdersForService% 8
(8 9
[ 	
	FromRoute	 
] 
Guid 
	serviceId "
)" #
{ 
var 
query 
= 
new $
GetOrdersForServiceQuery 0
(0 1
	serviceId1 :
): ;
;; <
var 
result 
= 
await 
	_mediator $
.$ %
Send% )
() *
query* /
)/ 0
;0 1
return 
result 
. 
Match 
< 
IActionResult )
>) *
(* +
success 
=> 
Ok 
( 
success !
)! "
," #
error 
=> 
Problem 
( 
error "
)" #
) 	
;	 

} 
[!! 
HttpPost!! 
(!! 
$str!! +
)!!+ ,
]!!, -
public"" 

async"" 
Task"" 
<"" 
IActionResult"" #
>""# $

StartOrder""% /
(""/ 0
[## 	
	FromRoute##	 
]## 
Guid## 
orderId##  
)##  !
{$$ 
var%% 
userId%% 
=%% 
	GetUserId%% 
(%% 
)%%  
;%%  !
var&& 
command&& 
=&& 
new&& $
UpdateOrderStatusCommand&& 2
(&&2 3
orderId&&3 :
,&&: ;
userId&&< B
,&&B C
OrderStatus&&D O
.&&O P

InProgress&&P Z
)&&Z [
;&&[ \
var(( 
result(( 
=(( 
await(( 
	_mediator(( $
.(($ %
Send((% )
((() *
command((* 1
)((1 2
;((2 3
return** 
result** 
.** 
Match** 
<** 
IActionResult** )
>**) *
(*** +
success++ 
=>++ 
Ok++ 
(++ 
$str++ )
)++) *
,++* +
error,, 
=>,, 
Problem,, 
(,, 
error,, "
),," #
),,# $
;,,$ %
}-- 
[// 
HttpPost// 
(// 
$str// ,
)//, -
]//- .
public00 

async00 
Task00 
<00 
IActionResult00 #
>00# $
FinishOrder00% 0
(000 1
[11 	
	FromRoute11	 
]11 
Guid11 
orderId11  
)11  !
{22 
var33 
userId33 
=33 
	GetUserId33 
(33 
)33  
;33  !
var44 
command44 
=44 
new44 $
UpdateOrderStatusCommand44 2
(442 3
orderId443 :
,44: ;
userId44< B
,44B C
OrderStatus44D O
.44O P
Finished44P X
)44X Y
;44Y Z
var66 
result66 
=66 
await66 
	_mediator66 $
.66$ %
Send66% )
(66) *
command66* 1
)661 2
;662 3
return88 
result88 
.88 
Match88 
<88 
IActionResult88 )
>88) *
(88* +
success99 
=>99 
Ok99 
(99 
$str99 *
)99* +
,99+ ,
error:: 
=>:: 
Problem:: 
(:: 
error:: "
)::" #
)::# $
;::$ %
};; 
[== 
HttpGet== 
(== 
$str== 
)== 
]== 
public>> 

async>> 
Task>> 
<>> 
IActionResult>> #
>>># $
GetOrdersForUser>>% 5
(>>5 6
)>>6 7
{?? 
var@@ 
userId@@ 
=@@ 
	GetUserId@@ 
(@@ 
)@@  
;@@  !
varAA 
queryAA 
=AA 
newAA !
GetOrdersForUserQueryAA -
(AA- .
userIdAA. 4
)AA4 5
;AA5 6
varBB 
resultBB 
=BB 
awaitBB 
	_mediatorBB $
.BB$ %
SendBB% )
(BB) *
queryBB* /
)BB/ 0
;BB0 1
returnDD 
resultDD 
.DD 
MatchDD 
<DD 
IActionResultDD )
>DD) *
(DD* +
successEE 
=>EE 
OkEE 
(EE 
successEE !
)EE! "
,EE" #
errorFF 
=>FF 
ProblemFF 
(FF 
errorFF "
)FF" #
)GG 	
;GG	 

}HH 
}II Í*
xD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Controllers\ContractorProfilesController.cs
	namespace

 	
Dealoviy


 
.

 
WebApi

 
.

 
Controllers

 %
;

% &
[ 
Route 
( 
$str  
)  !
]! "
public 
class (
ContractorProfilesController )
:* +
ApiController, 9
{ 
private 
readonly 
ISender 
	_mediator &
;& '
private 
readonly 
IMapper 
_mapper $
;$ %
public 
(
ContractorProfilesController '
(' (
ISender( /
mediator0 8
,8 9
IMapper: A
mapperB H
)H I
{ 
	_mediator 
= 
mediator 
; 
_mapper 
= 
mapper 
; 
} 
[ 
HttpPost 
] 
public 

async 
Task 
< 
IActionResult #
># $#
CreateContractorProfile% <
(< ="
ContractProfileRequest= S
requestT [
)[ \
{ 
var 
userId 
= 
	GetUserId 
( 
)  
;  !
var 
command 
= 
new *
CreateContractorProfileCommand 8
(8 9
userId 
, 
request 
. 
AdditionalInfo "
," #
_mapper   
.   
Map   
<   
List   
<   
ContactInfoModel   -
>  - .
>  . /
(  / 0
request  0 7
.  7 8
ContactInfos  8 D
)  D E
)!! 	
;!!	 

var## 
result## 
=## 
await## 
	_mediator## $
.##$ %
Send##% )
(##) *
command##* 1
)##1 2
;##2 3
return%% 
result%% 
.%% 
Match%% 
<%% 
IActionResult%% )
>%%) *
(%%* +
success&& 
=>&& 
Ok&& 
(&& 
$str&& C
)&&C D
,&&D E
error'' 
=>'' 
Problem'' 
('' 
error'' "
)''" #
)(( 	
;((	 

})) 
[++ 
HttpGet++ 
(++ 
$str++ "
)++" #
]++# $
public,, 

async,, 
Task,, 
<,, 
IActionResult,, #
>,,# $ 
GetContractorProfile,,% 9
(,,9 :
Guid,,: >
contractorId,,? K
),,K L
{-- 
var.. 
query.. 
=.. 
new.. )
GetContractorProfileByIdQuery.. 5
(..5 6
contractorId..6 B
)..B C
;..C D
var00 
result00 
=00 
await00 
	_mediator00 $
.00$ %
Send00% )
(00) *
query00* /
)00/ 0
;000 1
return22 
result22 
.22 
Match22 
<22 
IActionResult22 )
>22) *
(22* +
success33 
=>33 
Ok33 
(33 
_mapper33 !
.33! "
Map33" %
<33% &%
ContractorProfileResponse33& ?
>33? @
(33@ A
success33A H
)33H I
)33I J
,33J K
error44 
=>44 
Problem44 
(44 
error44 "
)44" #
)55 	
;55	 

}66 
[88 
HttpPut88 
]88 
public99 

async99 
Task99 
<99 
IActionResult99 #
>99# $#
UpdateContractorProfile99% <
(99< ="
ContractProfileRequest99= S
request99T [
)99[ \
{:: 
var;; 
userId;; 
=;; 
	GetUserId;; 
(;; 
);;  
;;;  !
var== 
command== 
=== 
new== *
UpdateContractorProfileCommand== 8
(==8 9
userId>> 
,>> 
request?? 
.?? 
AdditionalInfo?? "
,??" #
_mapper@@ 
.@@ 
Map@@ 
<@@ 
List@@ 
<@@ 
ContactInfoModel@@ -
>@@- .
>@@. /
(@@/ 0
request@@0 7
.@@7 8
ContactInfos@@8 D
)@@D E
)AA 	
;AA	 

varCC 
resultCC 
=CC 
awaitCC 
	_mediatorCC $
.CC$ %
SendCC% )
(CC) *
commandCC* 1
)CC1 2
;CC2 3
returnEE 
resultEE 
.EE 
MatchEE 
<EE 
IActionResultEE )
>EE) *
(EE* +
successFF 
=>FF 
OkFF 
(FF 
$strFF C
)FFC D
,FFD E
errorGG 
=>GG 
ProblemGG 
(GG 
errorGG "
)GG" #
)HH 	
;HH	 

}II 
}JJ §
lD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Controllers\CitiesController.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Controllers %
;% &
[

 
AllowAnonymous

 
]

 
[ 
Route 
( 
$str 
) 
] 
public 
class 
CitiesController 
: 
ApiController  -
{ 
private 
readonly 
ISender 
	_mediator &
;& '
private 
readonly 
IMapper 
_mapper $
;$ %
public 

CitiesController 
( 
ISender #
mediator$ ,
,, -
IMapper. 5
mapper6 <
)< =
{ 
	_mediator 
= 
mediator 
; 
_mapper 
= 
mapper 
; 
} 
[ 
HttpGet 
( 
$str 
) 
]  
public 

async 
Task 
< 
IActionResult #
># $
GetCitiesInRegion% 6
(6 7
Guid7 ;
regionId< D
)D E
{ 
var 
query 
= 
new "
GetCitiesInRegionQuery .
(. /
regionId/ 7
)7 8
;8 9
var 
cities 
= 
await 
	_mediator $
.$ %
Send% )
() *
query* /
)/ 0
;0 1
return 
Ok 
( 
_mapper 
. 
Map 
< 
IEnumerable )
<) *
CityResponse* 6
>6 7
>7 8
(8 9
cities9 ?
)? @
)@ A
;A B
} 
} ·
tD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Controllers\AuthenticationController.cs
	namespace

 	
Dealoviy


 
.

 
WebApi

 
.

 
Controllers

 %
;

% &
[ 
AllowAnonymous 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class $
AuthenticationController %
:& '
ApiController( 5
{ 
private 
readonly 
ISender 
	_mediator &
;& '
private 
readonly 
IMapper 
_mapper $
;$ %
public 
$
AuthenticationController #
(# $
ISender$ +
mediator, 4
,4 5
IMapper6 =
mapper> D
)D E
{ 
	_mediator 
= 
mediator 
; 
_mapper 
= 
mapper 
; 
} 
[ 
HttpPost 
( 
$str 
) 
] 
public 

async 
Task 
< 
IActionResult #
># $
Register% -
(- .
RegisterRequest. =
request> E
)E F
{ 
var 
command 
= 
_mapper 
. 
Map !
<! "
RegisterCommand" 1
>1 2
(2 3
request3 :
): ;
;; <
var 
result 
= 
await 
	_mediator $
.$ %
Send% )
() *
command* 1
)1 2
;2 3
return 
result 
. 
Match 
( 

authResult   
=>   
Ok   
(   
_mapper   $
.  $ %
Map  % (
<  ( )"
AuthenticationResponse  ) ?
>  ? @
(  @ A

authResult  A K
)  K L
)  L M
,  M N
errors!! 
=>!! 
Problem!! 
(!! 
errors!! $
)!!$ %
)!!% &
;!!& '
}"" 
[$$ 
HttpPost$$ 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 

async%% 
Task%% 
<%% 
IActionResult%% #
>%%# $
Login%%% *
(%%* +
LoginRequest%%+ 7
request%%8 ?
)%%? @
{&& 
var'' 
command'' 
='' 
_mapper'' 
.'' 
Map'' !
<''! "

LoginQuery''" ,
>'', -
(''- .
request''. 5
)''5 6
;''6 7
var)) 
result)) 
=)) 
await)) 
	_mediator)) $
.))$ %
Send))% )
())) *
command))* 1
)))1 2
;))2 3
return++ 
result++ 
.++ 
Match++ 
(++ 

authResult,, 
=>,, 
Ok,, 
(,, 
_mapper,, $
.,,$ %
Map,,% (
<,,( )"
AuthenticationResponse,,) ?
>,,? @
(,,@ A

authResult,,A K
),,K L
),,L M
,,,M N
errors-- 
=>-- 
Problem-- 
(-- 
errors-- $
)--$ %
)--% &
;--& '
}.. 
}// ­#
iD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Controllers\ApiController.cs
	namespace		 	
Dealoviy		
 
.		 
WebApi		 
.		 
Controllers		 %
;		% &
[ 
ApiController 
] 
[ 
	Authorize 

]
 
public 
class 
ApiController 
: 
ControllerBase +
{ 
	protected 
IActionResult 
Problem #
(# $
List$ (
<( )
Error) .
>. /
errors0 6
)6 7
{ 
if 

( 
errors 
. 
Count 
is 
$num 
) 
{ 	
return 
Problem 
( 
) 
; 
} 	
if 

( 
errors 
. 
All 
( 
error 
=> 
error  %
.% &
Type& *
==+ -
	ErrorType. 7
.7 8

Validation8 B
)B C
)C D
{ 	
return 
ValidationProblem $
($ %
errors% +
)+ ,
;, -
} 	
return 
Problem 
( 
errors 
[ 
$num 
]  
)  !
;! "
} 
	protected 
Guid 
	GetUserId 
( 
) 
{ 
var   
userIdClaim   
=   
HttpContext   %
.  % &
User  & *
.  * +
FindFirstValue  + 9
(  9 :
	claimType  : C
:  C D#
JwtRegisteredClaimNames  E \
.  \ ]
Sub  ] `
)  ` a
;  a b
return!! 
userIdClaim!! 
is!! 
null!! "
?!!# $
Guid!!% )
.!!) *
Empty!!* /
:!!0 1
Guid!!2 6
.!!6 7
Parse!!7 <
(!!< =
userIdClaim!!= H
)!!H I
;!!I J
}"" 
private$$ 
IActionResult$$ 
Problem$$ !
($$! "
Error$$" '
error$$( -
)$$- .
{%% 
var&& 

statusCode&& 
=&& 
error&& 
.&& 
Type&& #
switch&&$ *
{'' 	
	ErrorType(( 
.(( 
Conflict(( 
=>(( !
StatusCodes((" -
.((- .
Status409Conflict((. ?
,((? @
	ErrorType)) 
.)) 

Validation))  
=>))! #
StatusCodes))$ /
.))/ 0
Status400BadRequest))0 C
,))C D
	ErrorType** 
.** 
NotFound** 
=>** !
StatusCodes**" -
.**- .
Status404NotFound**. ?
,**? @
	ErrorType++ 
.++ 
Unauthorized++ "
=>++# %
StatusCodes++& 1
.++1 2
Status403Forbidden++2 D
,++D E
_,, 
=>,, 
StatusCodes,, 
.,, (
Status500InternalServerError,, 9
,,,9 :
}-- 	
;--	 

return// 
Problem// 
(// 

statusCode// !
://! "

statusCode//# -
,//- .
title/// 4
://4 5
error//6 ;
.//; <
Description//< G
)//G H
;//H I
}00 
private22 
IActionResult22 
ValidationProblem22 +
(22+ ,
List22, 0
<220 1
Error221 6
>226 7
errors228 >
)22> ?
{33 
var44  
modelStateDictionary44  
=44! "
new44# & 
ModelStateDictionary44' ;
(44; <
)44< =
;44= >
errors66 
.66 
ForEach66 
(66 
error66 
=>66  
modelStateDictionary66  4
.664 5
AddModelError665 B
(66B C
error66C H
.66H I
Code66I M
,66M N
error66O T
.66T U
Description66U `
)66` a
)66a b
;66b c
return88 
ValidationProblem88  
(88  ! 
modelStateDictionary88! 5
)885 6
;886 7
}99 
}:: ×
zD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Common\Mappings\ServiceSearchMappingConfig.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Common  
.  !
Mappings! )
;) *
public 
class &
ServiceSearchMappingConfig '
:( )
	IRegister* 3
{ 
public		 

void		 
Register		 
(		 
TypeAdapterConfig		 *
config		+ 1
)		1 2
{

 
config 
. 
	NewConfig 
< 
ServiceSearchResult ,
,, -!
ServiceSearchResponse. C
>C D
(D E
)E F
. 
Map 
( 
dest 
=> 
dest 
. 
Services &
,& '
src( +
=> 
src 
. 
Services 
.  
Select  &
(& '
service' .
=>/ 1
service2 9
.9 :
Adapt: ?
<? @
ServiceResponse@ O
>O P
(P Q
)Q R
)R S
)S T
. 
Map 
( 
dest 
=> 
dest 
, 
src "
=># %
src& )
)) *
;* +
} 
} •
sD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Common\Mappings\RegionMappingConfig.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Common  
.  !
Mappings! )
;) *
public 
class 
RegionMappingConfig  
:! "
	IRegister# ,
{ 
public		 

void		 
Register		 
(		 
TypeAdapterConfig		 *
config		+ 1
)		1 2
{

 
config 
. 
	NewConfig 
< 
RegionResult %
,% &
RegionResponse' 5
>5 6
(6 7
)7 8
;8 9
} 
} Í
sD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Common\Mappings\DependencyInjection.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Common  
.  !
Mappings! )
;) *
public 
static 
class 
DependencyInjection '
{ 
public 

static 
IServiceCollection $
AddMappings% 0
(0 1
this1 5
IServiceCollection6 H
servicesI Q
)Q R
{		 
var

 
config

 
=

 
TypeAdapterConfig

 &
.

& '
GlobalSettings

' 5
;

5 6
var 
webApiAssembly 
= 
typeof #
(# $
Dealoviy$ ,
., -
WebApi- 3
.3 4
DependencyInjection4 G
)G H
.H I
AssemblyI Q
;Q R
var 
applicationAssembly 
=  !
typeof" (
(( )
Dealoviy) 1
.1 2
Application2 =
.= >
DependencyInjection> Q
)Q R
.R S
AssemblyS [
;[ \
config 
. 
Scan 
( 
webApiAssembly "
," #
applicationAssembly$ 7
)7 8
;8 9
services 
. 
AddSingleton 
( 
config $
)$ %
;% &
services 
. 
	AddScoped 
< 
IMapper "
," #
ServiceMapper$ 1
>1 2
(2 3
)3 4
;4 5
return 
services 
; 
} 
} ³
wD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Common\Mappings\ContractorProfileConfig.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Common  
.  !
Mappings! )
;) *
public 
class #
ContractorProfileConfig $
:% &
	IRegister' 0
{ 
public		 

void		 
Register		 
(		 
TypeAdapterConfig		 *
config		+ 1
)		1 2
{

 
config 
. 
	NewConfig 
< #
ContractorProfileResult 0
,0 1%
ContractorProfileResponse2 K
>K L
(L M
)M N
;N O
} 
} 
qD:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Common\Mappings\CityMappingConfig.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Common  
.  !
Mappings! )
;) *
public 
class 
CityMappingConfig 
:  
	IRegister! *
{ 
public		 

void		 
Register		 
(		 
TypeAdapterConfig		 *
config		+ 1
)		1 2
{

 
config 
. 
	NewConfig 
< 

CityResult #
,# $
CityResponse% 1
>1 2
(2 3
)3 4
;4 5
} 
} É	
{D:\KPI\Labs_5sem\Dealovyi\pa-demyanchuk-ole\backend\Dealoviy\Dealoviy.WebApi\Common\Mappings\AuthenticationMappingConfig.cs
	namespace 	
Dealoviy
 
. 
WebApi 
. 
Common  
.  !
Mappings! )
;) *
public		 
class		 '
AuthenticationMappingConfig		 (
:		) *
	IRegister		+ 4
{

 
public 

void 
Register 
( 
TypeAdapterConfig *
config+ 1
)1 2
{ 
config 
. 
	NewConfig 
< 
RegisterRequest (
,( )
RegisterCommand* 9
>9 :
(: ;
); <
;< =
config 
. 
	NewConfig 
< 
LoginRequest %
,% &

LoginQuery' 1
>1 2
(2 3
)3 4
;4 5
config 
. 
	NewConfig 
<  
AuthenticationResult -
,- ."
AuthenticationResponse/ E
>E F
(F G
)G H
;H I
} 
} 